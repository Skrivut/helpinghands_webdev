<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Profile - Helping Hands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css"
    />
    <style>
      /* Include your style.css and profile.css content here or link them */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .main-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 5%;
        background: #2c3e50;
        color: white;
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .site-title {
        margin: 0;
        font-size: 1.2rem;
      }

      .icon-buttons-group {
        display: flex;
        gap: 10px;
      }

      .btn.icon-btn {
        background: transparent;
        border: 2px solid white;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .btn.icon-btn:hover {
        background: white;
        color: #2c3e50;
      }

      /* Include rest of profile.css styles or link the file */
    </style>
    <link rel="stylesheet" href="./profile.css" />
  </head>
  <body>
    <nav class="main-nav">
      <div style="display: flex; align-items: center; gap: 15px">
        <button
          onclick="window.location.href='./dashboard.html'"
          class="btn icon-btn"
        >
          <i class="uil uil-arrow-left"></i>
        </button>
        <h4 class="site-title">Helping Hands - My Profile</h4>
      </div>
      <div class="icon-buttons-group">
        <button id="theme-toggle" class="btn icon-btn">
          <i class="uil uil-moon"></i>
        </button>
      </div>
    </nav>

    <div class="main-content-area">
      <section class="profile-section">
        <div class="profile-container">
          <div class="profile-header">
            <div class="profile-cover" id="profileCover">
              <button class="edit-background-btn" id="editBackgroundBtn">
                <i class="uil uil-image"></i>
              </button>
            </div>
            <input
              type="file"
              id="backgroundUpload"
              style="display: none"
              accept="image/*"
            />

            <div class="profile-info-wrapper">
              <div class="profile-avatar">
                <img
                  id="profileAvatar"
                  src="./images/oak_sign.png"
                  alt="Profile Avatar"
                />
                <button class="edit-avatar-btn" id="editAvatarBtn">
                  <i class="uil uil-camera"></i>
                </button>
                <input
                  type="file"
                  id="avatarUpload"
                  style="display: none"
                  accept="image/*"
                />
              </div>

              <div class="profile-details">
                <h1 id="profileName" class="profile-name">John Doe</h1>
                <p id="profileStatus" class="profile-status">
                  <span class="status-indicator"></span> Active
                </p>
                <p id="profileLocation" class="profile-location">
                  <i class="uil uil-map-marker"></i> Cebu City, Philippines
                </p>
                <p id="profileBio" class="profile-bio">
                  Passionate about sustainable living and trading quality items.
                </p>

                <div class="profile-stats">
                  <div class="stat-item">
                    <span class="stat-number" id="tradeCount">5</span>
                    <span class="stat-label">Successful Trades</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-number" id="itemCount">12</span>
                    <span class="stat-label">Items Listed</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-number" id="ratingCount">4.8</span>
                    <span class="stat-label">Rating</span>
                  </div>
                </div>
              </div>

              <div class="profile-actions">
                <button class="btn-edit-profile" id="editProfileBtn">
                  <i class="uil uil-edit"></i> Edit Profile
                </button>
              </div>
            </div>
          </div>

          <div class="profile-tabs">
            <button class="tab-btn active" data-tab="trades">
              <i class="uil uil-exchange"></i> Trade Offers
            </button>
            <button class="tab-btn" data-tab="items">
              <i class="uil uil-list"></i> My Items
            </button>
            <button class="tab-btn" data-tab="about">
              <i class="uil uil-info-circle"></i> About
            </button>
          </div>

          <div class="tab-content active" id="trades-tab">
            <div class="trades-header">
              <h2 class="section-title">Pending Trade Offers</h2>
              <p class="trades-subtitle">
                Review and manage all incoming trade proposals
              </p>
            </div>
            <div id="tradeOffersContainer" class="trades-grid"></div>
          </div>

          <div class="tab-content" id="items-tab">
            <div class="items-header">
              <h2 class="section-title">My Items for Trade</h2>
              <button class="btn btn-add-item">
                <i class="uil uil-plus"></i> Add New Item
              </button>
            </div>
            <div id="myItemsContainer" class="items-grid"></div>
          </div>

          <div class="tab-content" id="about-tab">
            <div class="about-content">
              <h2 class="section-title">About</h2>
              <div class="about-section">
                <h3 class="about-subtitle">Member Information</h3>
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">Member Since:</span>
                    <span class="info-value">January 2024</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">Location:</span>
                    <span class="info-value">Cebu City, Philippines</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Modals -->
    <div class="modal" id="backgroundModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Change Background</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="background-options">
            <h3 class="bg-section-title">Preset Colors</h3>
            <div class="color-grid">
              <div
                class="color-option"
                data-color="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
              >
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #667eea 0%,
                      #764ba2 100%
                    );
                  "
                ></div>
                <span>Purple</span>
              </div>
              <div
                class="color-option"
                data-color="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
              >
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #4facfe 0%,
                      #00f2fe 100%
                    );
                  "
                ></div>
                <span>Blue</span>
              </div>
            </div>
            <h3 class="bg-section-title">Upload Image</h3>
            <div class="upload-area" id="uploadArea">
              <i class="uil uil-cloud-upload"></i>
              <p>Click to upload</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="editProfileModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Profile</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="editName">Name</label>
            <input type="text" id="editName" class="form-control" />
          </div>
          <div class="form-group">
            <label for="editLocation">Location</label>
            <input type="text" id="editLocation" class="form-control" />
          </div>
          <div class="form-group">
            <label for="editBio">Bio</label>
            <textarea id="editBio" class="form-control" rows="4"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelEditBtn">Cancel</button>
          <button class="btn btn-primary" id="saveEditBtn">Save Changes</button>
        </div>
      </div>
    </div>

    <script src="./script.js"></script>
    <script>
      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadLoggedInUser();
        setupTabSwitching();
        setupModalListeners();
        setupEditProfile();
        setupAvatarUpload();
        setupBackgroundChanger();
      });

      // Load logged-in user
      function loadLoggedInUser() {
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (!currentUser) {
          alert("Please log in to view your profile");
          window.location.href = "./login_signup.html";
          return;
        }

        document.getElementById("profileName").textContent =
          currentUser.username;
        if (currentUser.bio)
          document.getElementById("profileBio").textContent = currentUser.bio;
        if (currentUser.avatar)
          document.getElementById("profileAvatar").src = currentUser.avatar;
        if (currentUser.location) {
          document.querySelector(
            ".profile-location"
          ).innerHTML = `<i class="uil uil-map-marker"></i> ${currentUser.location}`;
        }

        const savedBg = localStorage.getItem(
          `profileBackground_${currentUser.username}`
        );
        if (savedBg) {
          document.getElementById("profileCover").style.backgroundImage =
            savedBg;
        }
      }

      // Tab switching
      function setupTabSwitching() {
        document.querySelectorAll(".tab-btn").forEach((tab) => {
          tab.addEventListener("click", function () {
            document
              .querySelectorAll(".tab-btn")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            this.classList.add("active");
            document
              .getElementById(`${this.dataset.tab}-tab`)
              .classList.add("active");
          });
        });
      }

      // Modal listeners
      function setupModalListeners() {
        document.querySelectorAll(".close-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            this.closest(".modal").classList.remove("show");
          });
        });

        window.addEventListener("click", function (e) {
          if (e.target.classList.contains("modal")) {
            e.target.classList.remove("show");
          }
        });
      }

      // Edit profile
      function setupEditProfile() {
        document
          .getElementById("editProfileBtn")
          .addEventListener("click", function () {
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            document.getElementById("editName").value = currentUser.username;
            document.getElementById("editLocation").value =
              currentUser.location || "Cebu City, Philippines";
            document.getElementById("editBio").value = currentUser.bio || "";
            document.getElementById("editProfileModal").classList.add("show");
          });

        document
          .getElementById("cancelEditBtn")
          .addEventListener("click", function () {
            document
              .getElementById("editProfileModal")
              .classList.remove("show");
          });

        document
          .getElementById("saveEditBtn")
          .addEventListener("click", function () {
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            const newName = document.getElementById("editName").value;
            const newLocation = document.getElementById("editLocation").value;
            const newBio = document.getElementById("editBio").value;

            document.getElementById("profileName").textContent = newName;
            document.querySelector(
              ".profile-location"
            ).innerHTML = `<i class="uil uil-map-marker"></i> ${newLocation}`;
            document.getElementById("profileBio").textContent = newBio;

            currentUser.username = newName;
            currentUser.location = newLocation;
            currentUser.bio = newBio;
            localStorage.setItem("currentUser", JSON.stringify(currentUser));

            document
              .getElementById("editProfileModal")
              .classList.remove("show");
            alert("Profile updated successfully!");
          });
      }

      // Avatar upload
      function setupAvatarUpload() {
        document
          .getElementById("editAvatarBtn")
          .addEventListener("click", () => {
            document.getElementById("avatarUpload").click();
          });

        document
          .getElementById("avatarUpload")
          .addEventListener("change", function () {
            if (this.files[0]) {
              const reader = new FileReader();
              reader.onload = function (e) {
                const currentUser = JSON.parse(
                  localStorage.getItem("currentUser")
                );
                document.getElementById("profileAvatar").src = e.target.result;
                currentUser.avatar = e.target.result;
                localStorage.setItem(
                  "currentUser",
                  JSON.stringify(currentUser)
                );
              };
              reader.readAsDataURL(this.files[0]);
            }
          });
      }

      // Background changer
      function setupBackgroundChanger() {
        document
          .getElementById("editBackgroundBtn")
          .addEventListener("click", () => {
            document.getElementById("backgroundModal").classList.add("show");
          });

        document.querySelectorAll(".color-option").forEach((option) => {
          option.addEventListener("click", function () {
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            const color = this.dataset.color;
            document.getElementById("profileCover").style.backgroundImage =
              color;
            localStorage.setItem(
              `profileBackground_${currentUser.username}`,
              color
            );
            document.getElementById("backgroundModal").classList.remove("show");
          });
        });

        document.getElementById("uploadArea").addEventListener("click", () => {
          document.getElementById("backgroundUpload").click();
        });

        document
          .getElementById("backgroundUpload")
          .addEventListener("change", function () {
            if (this.files[0]) {
              const reader = new FileReader();
              reader.onload = function (e) {
                const currentUser = JSON.parse(
                  localStorage.getItem("currentUser")
                );
                const bgUrl = `url('${e.target.result}')`;
                const cover = document.getElementById("profileCover");
                cover.style.backgroundImage = bgUrl;
                cover.style.backgroundSize = "cover";
                cover.style.backgroundPosition = "center";
                localStorage.setItem(
                  `profileBackground_${currentUser.username}`,
                  bgUrl
                );
                document
                  .getElementById("backgroundModal")
                  .classList.remove("show");
              };
              reader.readAsDataURL(this.files[0]);
            }
          });
      }
    </script>
  </body>
</html>
